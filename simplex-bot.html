<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../flowbased-polymer/mixin.html">
<link rel="import" href="../google-youtube/google-youtube.html">
<link rel="import" href="bot-component.html">
<link rel="import" href="say-something.html">
<link rel="import" href="speech-mic.html">
<link rel="import" href="display-fact.html">
<link rel="import" href="../alu-charts/chart-donut.html">


<dom-module id="simplex-bot">
  <template>
    <style>
      :host {
        display: block;
        height: 100%;
      }
    </style>

    <div id="bot">
      <div class="bubble you">Good Evening!</div>
      <div class="bubble me">which pet is this</div>
      <div class="bubble you">I'm sorry, I didn't understand that.</div>
    </div>
    <speech-mic complete-transcript="{{txt}}" @-speech-mic-result="-texteingabe"></speech-mic>
    [[txt]]
    <hr>
    [[response.msg.text]]

    <bot-component Æ’-query="-texteingabe" response="{{response}}" on-response-changed="_parse"></bot-component>
    <say-something id="say"></say-something>
  </template>
</dom-module>


<script>
  /**
   * `simplex-bot`
   *
   *
   * @customElement
   * @polymer
   * @demo demo/index.html
   * @mixes FBPMixin
   */
  class SimplexBot extends FBPMixin(Polymer.Element) {
    constructor() {
      super();
    }

    static get is() {
      return 'simplex-bot';
    }

    static get properties() {
      return {}
    }

    _parse(e) {
      let response = e.detail.value;
      switch (response.type) {
        case 'song':
          var v, customElement;
          //entferne
          v = this.shadowRoot.querySelector('google-youtube');
          if (v != undefined) {
            this.$.bot.removeChild(v)
            console.log(v)
          }
          customElement = document.createElement('google-youtube');
          customElement.setAttribute("autoplay", true);
          customElement.setAttribute("video-id", response.msg.id);
          this.$.bot.appendChild(customElement);

          /**
          * Fired when
          * detail payload:
          * @event request-mega
          */
          let customEvent = new Event('request-mega', {composed:true, bubbles: true});
          this.dispatchEvent(customEvent)

          break;

        case 'selbstbehalt':
          v = this.shadowRoot.querySelector('chart-donut');
          if (v != undefined) {
            this.$.bot.removeChild(v)
            console.log(v)
          }
          customElement = document.createElement('chart-donut');
          this.$.bot.appendChild(customElement);
          customElement.set("data", response.msg.data);
          console.log(response.msg.data)
          this.$.say.set('text', response.msg.text);
          break;

        case 'time':

          this.$.say.set('text', response.msg.text);
          break;

        default:
          this.$.say.set('text', response.msg.text)
      }

    }
  }

  window.customElements.define(SimplexBot.is, SimplexBot);

</script>
